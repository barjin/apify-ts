<!doctype html>
<html class="docs-version-2.0.6" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="Apify SDK" href="/apify-ts/opensearch.xml"><title data-react-helmet="true">Migration to version 1 | Apify SDK</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://apify.github.io/apify-ts/img/apify_og_SDK.png"><meta data-react-helmet="true" name="twitter:image" content="https://apify.github.io/apify-ts/img/apify_og_SDK.png"><meta data-react-helmet="true" property="og:url" content="https://apify.github.io/apify-ts/docs/guides/migration-to-v1"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="2.0.6"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-2.0.6"><meta data-react-helmet="true" property="og:title" content="Migration to version 1 | Apify SDK"><meta data-react-helmet="true" name="description" content="- Summary"><meta data-react-helmet="true" property="og:description" content="- Summary"><link data-react-helmet="true" rel="icon" href="/apify-ts/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://apify.github.io/apify-ts/docs/guides/migration-to-v1"><link data-react-helmet="true" rel="alternate" href="https://apify.github.io/apify-ts/docs/guides/migration-to-v1" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apify.github.io/apify-ts/docs/guides/migration-to-v1" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/apify-ts/assets/css/styles.db30589b.css">
<link rel="preload" href="/apify-ts/assets/js/runtime~main.8fcb332b.js" as="script">
<link rel="preload" href="/apify-ts/assets/js/main.66887e99.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/apify-ts/"><div class="navbar__logo"><img src="/apify-ts/img/apify_sdk.svg" alt="Apify SDK" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/apify-ts/img/apify_sdk_white.svg" alt="Apify SDK" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Apify SDK</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/apify-ts/docs/">Guide</a><a class="navbar__item navbar__link" href="/apify-ts/docs/examples/crawl-multiple-urls">Examples</a><a class="navbar__item navbar__link" href="/apify-ts/api">API reference</a><a href="https://github.com/apify/apify-js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/apify-ts/docs/">2.0.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/apify-ts/docs/next/guides/migration-to-v1">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/apify-ts/docs/guides/migration-to-v1">2.0.6</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/apify-ts/api">2.0.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/apify-ts/api/next">Next</a></li><li><a class="dropdown__link" href="/apify-ts/api">2.0.6</a></li></ul></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/apify-ts/"><img src="/apify-ts/img/apify_sdk.svg" alt="Apify SDK" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/apify-ts/img/apify_sdk_white.svg" alt="Apify SDK" class="themedImage_TMUO themedImage--dark_uzRr"><b>Apify SDK</b></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/apify-ts/docs/">Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/">Motivation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/apify-platform">Apify Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/request-storage">Request Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/result-storage">Result Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/environment-variables">Environment Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/proxy-management">Proxy Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/session-management">Session Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/apify-ts/docs/guides/docker-images">Running in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/apify-ts/docs/guides/migration-to-v1">Migration to version 1</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/apify-ts/docs/examples/accept-user-input">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/apify-ts/docs/api/apify">API Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/apify-ts/docs/typedefs/autoscaled-pool-options">Type Definitions</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.0.6</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migration to version 1</h1></header><ul><li><a href="#summary">Summary</a></li><li><a href="#migration-guide">Migration Guide</a></li><li><a href="#installation">Installation</a></li><li><a href="#running-on-apify-platform">Running on Apify Platform</a></li><li><a href="#handler-arguments-are-now-crawling-context">Handler arguments are now Crawling Context</a><ul><li><a href="#map-of-crawling-contexts-and-their-ids"><code>Map</code> of crawling contexts and their IDs</a></li><li><a href="#autoscaledpool-was-moved-under-crawlingcontextcrawler"><code>autoscaledPool</code> was moved under <code>crawlingContext.crawler</code></a></li></ul></li><li><a href="#replacement-of-puppeteerpool-with-browserpool">Replacement of <code>PuppeteerPool</code> with <code>BrowserPool</code></a><ul><li><a href="#access-to-running-browserpool">Access to running <code>BrowserPool</code></a></li><li><a href="#pages-now-have-ids">Pages now have IDs</a></li><li><a href="#configuration-and-lifecycle-hooks">Configuration and lifecycle hooks</a></li><li><a href="#introduction-of-browsercontroller">Introduction of <code>BrowserController</code></a></li><li><a href="#browserpool-methods-vs-puppeteerpool"><code>BrowserPool</code> methods vs <code>PuppeteerPool</code></a></li></ul></li><li><a href="#updated-puppeteercrawleroptions">Updated <code>PuppeteerCrawlerOptions</code></a><ul><li><a href="#removal-of-gotofunction">Removal of <code>gotoFunction</code></a></li><li><a href="#launchpuppeteeroptions--launchcontext"><code>launchPuppeteerOptions</code> =&gt; <code>launchContext</code></a></li><li><a href="#removal-of-launchpuppeteerfunction">Removal of <code>launchPuppeteerFunction</code></a></li></ul></li><li><a href="#launch-functions">Launch functions</a><ul><li><a href="#updated-arguments">Updated arguments</a></li><li><a href="#custom-modules">Custom modules</a></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>After 3.5 years of rapid development and a lot of breaking changes and deprecations,
here comes the result - <strong>Apify SDK v1</strong>. There were two goals for this release. <strong>Stability</strong>
and <strong>adding support for more browsers</strong> - Firefox and Webkit (Safari).</p><p>The SDK has grown quite popular over the years, powering thousands of web scraping
and automation projects. We think our developers deserve a stable environment to work
in and by releasing SDK v1, <strong>we commit to only make breaking changes once a year,
with a new major release</strong>.</p><p>We added support for more browsers by replacing <code>PuppeteerPool</code> with
<a href="https://github.com/apify/browser-pool" target="_blank" rel="noopener"><code>browser-pool</code></a>. A new library that we created
specifically for this purpose. It builds on the ideas from <code>PuppeteerPool</code> and extends
them to support <a href="https://github.com/microsoft/playwright" target="_blank" rel="noopener">Playwright</a>. Playwright is
a browser automation library similar to Puppeteer. It works with all well known browsers
and uses almost the same interface as Puppeteer, while adding useful features and simplifying
common tasks. Don&#x27;t worry, you can still use Puppeteer with the new <code>BrowserPool</code>.</p><p>A large breaking change is that neither <code>puppeteer</code> nor <code>playwright</code> are bundled with
the SDK v1. To make the choice of a library easier and installs faster, users will
have to install the selected modules and versions themselves. This allows us to add
support for even more libraries in the future.</p><p>Thanks to the addition of Playwright we now have a <code>PlaywrightCrawler</code>. It is very similar
to <code>PuppeteerCrawler</code> and you can pick the one you prefer. It also means we needed to make
some interface changes. The <code>launchPuppeteerFunction</code> option of <code>PuppeteerCrawler</code> is gone
and <code>launchPuppeteerOptions</code> were replaced by <code>launchContext</code>. We also moved things around
in the <code>handlePageFunction</code> arguments. See the
<a href="#migration-guide">migration guide</a>
for more detailed explanation and migration examples.</p><p>What&#x27;s in store for SDK v2? We want to split the SDK into smaller libraries,
so that everyone can install only the things they need. We plan a TypeScript migration
to make crawler development faster and safer. Finally, we will take a good look
at the interface of the whole SDK and update it to improve the developer experience.
Bug fixes and scraping features will of course keep landing in versions 1.X as well.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="migration-guide">Migration Guide<a class="hash-link" href="#migration-guide" title="Direct link to heading">â€‹</a></h2><p>There are a lot of breaking changes in the v1.0.0 release, but we&#x27;re confident that
updating your code will be a matter of minutes. Below, you&#x27;ll find examples how to do it
and also short tutorials how to use many of the new features.</p><blockquote><p>Many of the new features are made with power users in mind,
so don&#x27;t worry if something looks complicated. You don&#x27;t need to use it.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">â€‹</a></h2><p>Previous versions of the SDK bundled the <code>puppeteer</code> package, so you did not have to install
it. SDK v1 supports also <code>playwright</code> and we don&#x27;t want to force users to install both.
To install SDK v1 with Puppeteer (same as previous versions), run:</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token function" style="color:#b29762">npm</span><span class="token plain"> </span><span class="token function" style="color:#b29762">install</span><span class="token plain"> apify puppeteer</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To install SDK v1 with Playwright run:</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token function" style="color:#b29762">npm</span><span class="token plain"> </span><span class="token function" style="color:#b29762">install</span><span class="token plain"> apify playwright</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>While we tried to add the most important functionality in the initial release,
you may find that there are still some utilities or options that are only
supported by Puppeteer and not Playwright.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="running-on-apify-platform">Running on Apify Platform<a class="hash-link" href="#running-on-apify-platform" title="Direct link to heading">â€‹</a></h2><p>If you want to make use of Playwright on the Apify Platform, you need to use a Docker image
that supports Playwright. We&#x27;ve created them for you, so head over to the new
<a href="https://sdk.apify.com/docs/guides/docker-images">Docker image guide</a> and pick the one
that best suits your needs.</p><p>Note that your <code>package.json</code> <strong>MUST</strong> include <code>puppeteer</code> and/or <code>playwright</code> as dependencies.
If you don&#x27;t list them, the libraries will be uninstalled from your <code>node_modules</code> folder
when you build your actors.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="handler-arguments-are-now-crawling-context">Handler arguments are now Crawling Context<a class="hash-link" href="#handler-arguments-are-now-crawling-context" title="Direct link to heading">â€‹</a></h2><p>Previously, arguments of user provided handler functions were provided in separate
objects. This made it difficult to track values across function invocations.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">args1</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    args1</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">hasOwnProperty</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;proxyInfo&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handleFailedRequestFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">args2</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    args2</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">hasOwnProperty</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;proxyInfo&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">args1 </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> args2 </span><span class="token comment" style="color:#b6ad9a">// false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This happened because a new arguments object was created for each function.
With SDK v1 we now have a single object called Crawling Context.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">crawlingContext1</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    crawlingContext1</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">hasOwnProperty</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;proxyInfo&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handleFailedRequestFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">crawlingContext2</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    crawlingContext2</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">hasOwnProperty</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;proxyInfo&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// All contexts are the same object.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">crawlingContext1 </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> crawlingContext2 </span><span class="token comment" style="color:#b6ad9a">// true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="map-of-crawling-contexts-and-their-ids"><code>Map</code> of crawling contexts and their IDs<a class="hash-link" href="#map-of-crawling-contexts-and-their-ids" title="Direct link to heading">â€‹</a></h3><p>Now that all the objects are the same, we can keep track of all running crawling contexts.
We can do that by working with the new <code>id</code> property of <code>crawlingContext</code>
This is useful when you need cross-context access.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">let</span><span class="token plain"> masterContextId</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> id</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> page</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> request</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> crawler </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">userData</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">masterPage</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        masterContextId </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> id</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token comment" style="color:#b6ad9a">// Prepare the master page.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#728fcb">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> masterContext </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">crawlingContexts</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">get</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">masterContextId</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> masterPage </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> masterContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> masterRequest </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> masterContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token comment" style="color:#b6ad9a">// Now we can manipulate the master data from another handlePageFunction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="autoscaledpool-was-moved-under-crawlingcontextcrawler"><code>autoscaledPool</code> was moved under <code>crawlingContext.crawler</code><a class="hash-link" href="#autoscaledpool-was-moved-under-crawlingcontextcrawler" title="Direct link to heading">â€‹</a></h3><p>To prevent bloat and to make access to certain key objects easier, we exposed a <code>crawler</code>
property on the handle page arguments.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> request</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> page</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> crawler </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">requestQueue</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">addRequest</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"> url</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;https://example.com&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">autoscaledPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">pause</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This also means that some shorthands like <code>puppeteerPool</code> or <code>autoscaledPool</code> were
no longer necessary.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">crawlingContext</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    crawlingContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">autoscaledPool</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// does NOT exist anymore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    crawlingContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">autoscaledPool</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// &lt;= this is correct usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="replacement-of-puppeteerpool-with-browserpool">Replacement of <code>PuppeteerPool</code> with <code>BrowserPool</code><a class="hash-link" href="#replacement-of-puppeteerpool-with-browserpool" title="Direct link to heading">â€‹</a></h2><p><code>BrowserPool</code> was created to extend <code>PuppeteerPool</code> with the ability to manage other
browser automation libraries. The API is similar, but not the same.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="access-to-running-browserpool">Access to running <code>BrowserPool</code><a class="hash-link" href="#access-to-running-browserpool" title="Direct link to heading">â€‹</a></h3><p>Only <code>PuppeteerCrawler</code> and <code>PlaywrightCrawler</code> use <code>BrowserPool</code>. You can access it
on the <code>crawler</code> object.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PlaywrightCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> page</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> crawler </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">browserPool</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// &lt;-----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">browserPool</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// &lt;-----</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="pages-now-have-ids">Pages now have IDs<a class="hash-link" href="#pages-now-have-ids" title="Direct link to heading">â€‹</a></h3><p>And they&#x27;re equal to <code>crawlingContext.id</code> which gives you access to full <code>crawlingContext</code>
in hooks. See <a href="#configuration-and-lifecycle-hooks">Lifecycle hooks</a> below.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> pageId </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> browserPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">getPageId</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="configuration-and-lifecycle-hooks">Configuration and lifecycle hooks<a class="hash-link" href="#configuration-and-lifecycle-hooks" title="Direct link to heading">â€‹</a></h3><p>The most important addition with <code>BrowserPool</code> are the
<a href="https://github.com/apify/browser-pool#browserpool" target="_blank" rel="noopener">lifecycle hooks</a>.
You can access them via <code>browserPoolOptions</code> in both crawlers. A full list of <code>browserPoolOptions</code>
can be found in <a href="https://github.com/apify/browser-pool#new-browserpooloptions" target="_blank" rel="noopener"><code>browser-pool</code> readme</a>.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    browserPoolOptions</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        retireBrowserAfterPageCount</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token number" style="color:#063289">10</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        preLaunchHooks</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">pageId</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> launchContext</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">                </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"> request </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">crawlingContexts</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">get</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">pageId</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#728fcb">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">userData</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">useHeadful</span><span class="token plain"> </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">                    launchContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">launchOptions</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">headless</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">false</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">                </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="introduction-of-browsercontroller">Introduction of <code>BrowserController</code><a class="hash-link" href="#introduction-of-browsercontroller" title="Direct link to heading">â€‹</a></h3><p><a href="https://github.com/apify/browser-pool#browsercontroller" target="_blank" rel="noopener"><code>BrowserController</code></a>
is a class of <code>browser-pool</code> that&#x27;s responsible for browser management.
Its purpose is to provide a single API for working with both Puppeteer and Playwright browsers.
It works automatically in the background, but if you ever wanted to close a browser properly,
you should use a <code>browserController</code> to do it. You can find it in the handle page arguments.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> page</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> browserController </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Wrong usage. Could backfire because it bypasses BrowserPool.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">browser</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">close</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Correct usage. Allows graceful shutdown.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> browserController</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">close</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> cookies </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token comment" style="color:#b6ad9a">/* some cookie objects */</span><span class="token punctuation" style="color:#b6ad9a">]</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Wrong usage. Will only work in Puppeteer and not Playwright.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">setCookies</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token spread operator" style="color:#063289">...</span><span class="token plain">cookies</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Correct usage. Will work in both.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> browserController</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">setCookies</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> cookies</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>BrowserController</code> also includes important information about the browser, such as
the context it was launched with. This was difficult to do before SDK v1.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">handlePageFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> browserController </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Information about the proxy used by the browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    browserController</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">launchContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">proxyInfo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Session used by the browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    browserController</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">launchContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="browserpool-methods-vs-puppeteerpool"><code>BrowserPool</code> methods vs <code>PuppeteerPool</code><a class="hash-link" href="#browserpool-methods-vs-puppeteerpool" title="Direct link to heading">â€‹</a></h3><p>Some functions were removed (in line with earlier deprecations), and some were changed a bit:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token comment" style="color:#b6ad9a">// OLD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> puppeteerPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">recyclePage</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">close</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token comment" style="color:#b6ad9a">// OLD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> puppeteerPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">retire</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">browser</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">browserPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">retireBrowserByPage</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token comment" style="color:#b6ad9a">// OLD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> puppeteerPool</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">serveLiveViewSnapshot</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// There&#x27;s no LiveView in BrowserPool</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="updated-puppeteercrawleroptions">Updated <code>PuppeteerCrawlerOptions</code><a class="hash-link" href="#updated-puppeteercrawleroptions" title="Direct link to heading">â€‹</a></h2><p>To keep <code>PuppeteerCrawler</code> and <code>PlaywrightCrawler</code> consistent, we updated the options.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="removal-of-gotofunction">Removal of <code>gotoFunction</code><a class="hash-link" href="#removal-of-gotofunction" title="Direct link to heading">â€‹</a></h3><p>The concept of a configurable <code>gotoFunction</code> is not ideal. Especially since we use a modified
<code>gotoExtended</code>. Users have to know this when they override <code>gotoFunction</code> if they want to
extend default behavior. We decided to replace <code>gotoFunction</code> with <code>preNavigationHooks</code> and
<code>postNavigationHooks</code>.</p><p>The following example illustrates how <code>gotoFunction</code> makes things complicated.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">gotoFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> request</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> page </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// pre-processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token function" style="color:#b29762">makePageStealthy</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Have to remember how to do this:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> response </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token function" style="color:#b29762">gotoExtended</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token comment" style="color:#b6ad9a">/* have to remember the defaults */</span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// post-processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">evaluate</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token dom variable" style="color:#93abdc">window</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">foo</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;bar&#x27;</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// Must not forget!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    gotoFunction</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With <code>preNavigationHooks</code> and <code>postNavigationHooks</code> it&#x27;s much easier. <code>preNavigationHooks</code>
are called with two arguments: <code>crawlingContext</code> and <code>gotoOptions</code>. <code>postNavigationHooks</code>
are called only with <code>crawlingContext</code>.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> preNavigationHooks </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> page </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#b29762">makePageStealthy</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">]</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> postNavigationHooks </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter punctuation" style="color:#b6ad9a">{</span><span class="token parameter"> page </span><span class="token parameter punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> page</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">evaluate</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token dom variable" style="color:#93abdc">window</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">foo</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;bar&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    preNavigationHooks</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    postNavigationHooks</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="launchpuppeteeroptions--launchcontext"><code>launchPuppeteerOptions</code> =&gt; <code>launchContext</code><a class="hash-link" href="#launchpuppeteeroptions--launchcontext" title="Direct link to heading">â€‹</a></h3><p>Those were always a point of confusion because they merged custom Apify options with
<code>launchOptions</code> of Puppeteer.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> launchPuppeteerOptions </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    useChrome</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// Apify option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    headless</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">false</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// Puppeteer option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Use the new <code>launchContext</code> object, which explicitly defines <code>launchOptions</code>.
<code>launchPuppeteerOptions</code> were removed.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    launchContext</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        useChrome</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// Apify option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        launchOptions</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            headless</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">false</span><span class="token plain"> </span><span class="token comment" style="color:#b6ad9a">// Puppeteer option</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>LaunchContext is also a type of <a href="https://github.com/apify/browser-pool" target="_blank" rel="noopener"><code>browser-pool</code></a> and
the structure is exactly the same there. SDK only adds extra options.</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="removal-of-launchpuppeteerfunction">Removal of <code>launchPuppeteerFunction</code><a class="hash-link" href="#removal-of-launchpuppeteerfunction" title="Direct link to heading">â€‹</a></h3><p><code>browser-pool</code> introduces the idea of <a href="https://github.com/apify/browser-pool#browserpool" target="_blank" rel="noopener">lifecycle hooks</a>,
which are functions that are executed when a certain event in the browser lifecycle happens.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">launchPuppeteerFunction</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">launchPuppeteerOptions</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">someVariable </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;chrome&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        launchPuppeteerOptions</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">useChrome</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">return</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPuppeteer</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">launchPuppeteerOptions</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    launchPuppeteerFunction</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now you can recreate the same functionality with a <code>preLaunchHook</code>:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#b29762">maybeLaunchChrome</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">pageId</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> launchContext</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#063289">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#728fcb">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">someVariable </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;chrome&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        launchContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">useChrome</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> crawler </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">new</span><span class="token plain"> </span><span class="token class-name">Apify</span><span class="token class-name punctuation" style="color:#b6ad9a">.</span><span class="token class-name">PuppeteerCrawler</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    browserPoolOptions</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        preLaunchHooks</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain">maybeLaunchChrome</span><span class="token punctuation" style="color:#b6ad9a">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token comment" style="color:#b6ad9a">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is better in multiple ways. It is consistent across both Puppeteer and Playwright.
It allows you to easily construct your browsers with pre-defined behavior:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> preLaunchHooks </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    maybeLaunchChrome</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    useHeadfulIfNeeded</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    injectNewFingerprint</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And thanks to the addition of <a href="#handler-arguments-are-now-crawling-context"><code>crawler.crawlingContexts</code></a>
the functions also have access to the <code>crawlingContext</code> of the <code>request</code> that triggered the launch.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> preLaunchHooks </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token keyword" style="color:#728fcb">async</span><span class="token plain"> </span><span class="token keyword" style="color:#728fcb">function</span><span class="token plain"> </span><span class="token function" style="color:#b29762">maybeLaunchChrome</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token parameter">pageId</span><span class="token parameter punctuation" style="color:#b6ad9a">,</span><span class="token parameter"> launchContext</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"> request </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> crawler</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">crawlingContexts</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">get</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">pageId</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#728fcb">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">userData</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">useHeadful</span><span class="token plain"> </span><span class="token operator" style="color:#063289">===</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            launchContext</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">launchOptions</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">headless</span><span class="token plain"> </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">false</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="launch-functions">Launch functions<a class="hash-link" href="#launch-functions" title="Direct link to heading">â€‹</a></h2><p>In addition to <code>Apify.launchPuppeteer()</code> we now also have <code>Apify.launchPlaywright()</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="updated-arguments">Updated arguments<a class="hash-link" href="#updated-arguments" title="Direct link to heading">â€‹</a></h3><p>We <a href="#launchpuppeteeroptions--launchcontext">updated the launch options object</a> because
it was a frequent source of confusion.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token comment" style="color:#b6ad9a">// OLD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPuppeteer</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    useChrome</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    headless</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPuppeteer</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    useChrome</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    launchOptions</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        headless</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> </span><span class="token boolean" style="color:#728fcb">true</span><span class="token punctuation" style="color:#b6ad9a">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="custom-modules">Custom modules<a class="hash-link" href="#custom-modules" title="Direct link to heading">â€‹</a></h3><p><code>Apify.launchPuppeteer</code> already supported the <code>puppeteerModule</code> option. With Playwright,
we normalized the name to <code>launcher</code> because the <code>playwright</code> module itself does not
launch browsers.</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="background-color:#faf8f5;color:#728fcb"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#728fcb"><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> puppeteer </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token function" style="color:#b29762">require</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;puppeteer&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword" style="color:#728fcb">const</span><span class="token plain"> playwright </span><span class="token operator" style="color:#063289">=</span><span class="token plain"> </span><span class="token function" style="color:#b29762">require</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token string" style="color:#728fcb">&#x27;playwright&#x27;</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPuppeteer</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// Is the same as:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPuppeteer</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    launcher</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> puppeteer</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPlaywright</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">)</span><span class="token punctuation" style="color:#b6ad9a">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token comment" style="color:#b6ad9a">// Is the same as:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token keyword control-flow" style="color:#728fcb">await</span><span class="token plain"> </span><span class="token maybe-class-name">Apify</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token method function property-access" style="color:#b29762">launchPlaywright</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token punctuation" style="color:#b6ad9a">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    launcher</span><span class="token operator" style="color:#063289">:</span><span class="token plain"> playwright</span><span class="token punctuation" style="color:#b6ad9a">.</span><span class="token property-access">chromium</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token punctuation" style="color:#b6ad9a">}</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-01-25T12:49:50.000Z">1/25/2022</time></b> by <b>Martin AdÃ¡mek</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/apify-ts/docs/guides/docker-images"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Running in Docker</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/apify-ts/docs/examples/accept-user-input"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Accept user input</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#migration-guide" class="table-of-contents__link toc-highlight">Migration Guide</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#running-on-apify-platform" class="table-of-contents__link toc-highlight">Running on Apify Platform</a></li><li><a href="#handler-arguments-are-now-crawling-context" class="table-of-contents__link toc-highlight">Handler arguments are now Crawling Context</a><ul><li><a href="#map-of-crawling-contexts-and-their-ids" class="table-of-contents__link toc-highlight"><code>Map</code> of crawling contexts and their IDs</a></li><li><a href="#autoscaledpool-was-moved-under-crawlingcontextcrawler" class="table-of-contents__link toc-highlight"><code>autoscaledPool</code> was moved under <code>crawlingContext.crawler</code></a></li></ul></li><li><a href="#replacement-of-puppeteerpool-with-browserpool" class="table-of-contents__link toc-highlight">Replacement of <code>PuppeteerPool</code> with <code>BrowserPool</code></a><ul><li><a href="#access-to-running-browserpool" class="table-of-contents__link toc-highlight">Access to running <code>BrowserPool</code></a></li><li><a href="#pages-now-have-ids" class="table-of-contents__link toc-highlight">Pages now have IDs</a></li><li><a href="#configuration-and-lifecycle-hooks" class="table-of-contents__link toc-highlight">Configuration and lifecycle hooks</a></li><li><a href="#introduction-of-browsercontroller" class="table-of-contents__link toc-highlight">Introduction of <code>BrowserController</code></a></li><li><a href="#browserpool-methods-vs-puppeteerpool" class="table-of-contents__link toc-highlight"><code>BrowserPool</code> methods vs <code>PuppeteerPool</code></a></li></ul></li><li><a href="#updated-puppeteercrawleroptions" class="table-of-contents__link toc-highlight">Updated <code>PuppeteerCrawlerOptions</code></a><ul><li><a href="#removal-of-gotofunction" class="table-of-contents__link toc-highlight">Removal of <code>gotoFunction</code></a></li><li><a href="#launchpuppeteeroptions--launchcontext" class="table-of-contents__link toc-highlight"><code>launchPuppeteerOptions</code> =&gt; <code>launchContext</code></a></li><li><a href="#removal-of-launchpuppeteerfunction" class="table-of-contents__link toc-highlight">Removal of <code>launchPuppeteerFunction</code></a></li></ul></li><li><a href="#launch-functions" class="table-of-contents__link toc-highlight">Launch functions</a><ul><li><a href="#updated-arguments" class="table-of-contents__link toc-highlight">Updated arguments</a></li><li><a href="#custom-modules" class="table-of-contents__link toc-highlight">Custom modules</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/apify-ts/docs/">Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/apify-ts/docs/examples/crawl-multiple-urls">Examples</a></li><li class="footer__item"><a class="footer__link-item" href="/apify-ts/docs/api/apify">API reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/jyEM2PRvMU" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/apify" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/apify" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/apifytech" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apify.com" target="_blank" class="footer__link-item">
        <span>
            Apify Cloud
            <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" style="margin-left: 0.3rem; position: relative; top: 1px;">
                <path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z">
                </path>
            </svg>
        </span>
    </a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" class="footer__link-item">
        <span>
            Docusaurus
            <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" style="margin-left: 0.3rem; position: relative; top: 1px;">
                <path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z">
                </path>
            </svg>
        </span>
    </a></li><li class="footer__item"><a href="https://github.com/apify/apify-js" target="_blank" class="footer__link-item">
        <span>
            GitHub
            <svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" style="margin-left: 0.3rem; position: relative; top: 1px;">
                <path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z">
                </path>
            </svg>
        </span>
    </a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/apify-ts/"><img src="/apify-ts/img/apify_logo.svg" alt="" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo" width="60px" height="60px"><img src="/apify-ts/img/apify_logo.svg" alt="" class="themedImage_TMUO themedImage--dark_uzRr footer__logo" width="60px" height="60px"></a></div><div class="footer__copyright">Copyright Â© 2021 Apify Technologies s.r.o.</div></div></div></footer></div>
<script src="/apify-ts/assets/js/runtime~main.8fcb332b.js"></script>
<script src="/apify-ts/assets/js/main.66887e99.js"></script>
</body>
</html>